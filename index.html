<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>IPTV Pro</title>
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<style>
:root {
  --primary: #0091EA;
  --bg: #111111;
  --surface: #000000;
  --text: #FFFFFF;
  --focus: #0091EA;
  --divider: #333333;
}
* { box-sizing: border-box; margin: 0; padding: 0; outline: none; user-select: none; }
body { background-color: var(--bg); color: var(--text); font-family: 'Roboto', sans-serif; font-size: 16px; overflow: hidden; height: 100vh; width: 100vw; }
#header { background-color: var(--primary); height: 40px; display: flex; align-items: center; padding-left: 10px; font-weight: 700; font-size: 18px; position: fixed; top: 0; left: 0; right: 0; z-index: 10; box-shadow: 0 2px 4px rgba(0,0,0,0.5); }
.view-section { display: none; margin-top: 40px; height: calc(100vh - 70px); overflow-y: auto; }
.view-section.active { display: block; }
.channel-item { padding: 12px 10px; border-bottom: 1px solid var(--divider); display: flex; align-items: center; background-color: transparent; cursor: pointer; }
.channel-item.focused, .menu-item.focused { background-color: var(--focus) !important; color: white !important; }
.channel-logo { width: 40px; height: 40px; margin-right: 15px; background: #fff; object-fit: contain; border-radius: 2px; }
.channel-info { flex: 1; overflow: hidden; }
.channel-name { font-weight: 500; display: block; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.group-title { font-size: 12px; color: #aaa; margin-top: 4px; display: block; }
.channel-item.focused .group-title { color: #ddd; }
.menu-item { padding: 15px 10px; border-bottom: 1px solid var(--divider); font-size: 16px; background: var(--surface); cursor: pointer; }
#search-view { padding: 0; }
#search-container { padding: 10px; background: #222; }
#search-input { width: 100%; padding: 8px; background: #000; border: 1px solid #555; color: white; font-size: 16px; }
#search-input:focus { border-color: var(--primary); }
#player-view { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: black; z-index: 100; display: none; }
video { width: 100%; height: 100%; object-fit: contain; }
#soft-keys { position: fixed; bottom: 0; left: 0; right: 0; height: 30px; background-color: var(--surface); display: flex; justify-content: space-between; align-items: center; padding: 0 10px; z-index: 200; border-top: 1px solid #333; }
.key-col { width: 33%; display: flex; align-items: center; height: 100%; }
#lsk { justify-content: flex-start; }
#csk { justify-content: center; }
#rsk { justify-content: flex-end; }
.key-icon { width: 24px; height: 24px; fill: white; }
#custom-alert-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.85); z-index: 9999; display: none; justify-content: center; align-items: center; }
.alert-box { background-color: #222; width: 85%; max-width: 300px; border: 1px solid #444; border-radius: 4px; overflow: hidden; box-shadow: 0 10px 20px rgba(0,0,0,0.5); }
.alert-header { background: var(--primary); color: white; padding: 10px; font-weight: bold; }
.alert-body { padding: 20px 15px; color: #ddd; font-size: 15px; line-height: 1.4; }
.alert-footer { padding: 10px; text-align: right; background: #111; }
.alert-btn { background: transparent; border: 2px solid var(--primary); color: var(--primary); padding: 5px 15px; font-weight: bold; text-transform: uppercase; }
.alert-btn:focus { background: var(--primary); color: white; }
#file-upload { display: none; }
</style>
</head>
<body>

<div id="header">IPTV</div>

<div id="home-view" class="view-section active">
  <div id="channel-list"></div>
</div>

<div id="menu-view" class="view-section">
  <div class="menu-item focused" data-action="search">Search Channel</div>
  <div class="menu-item" data-action="upload">Load Playlist (M3U)</div>
  <div class="menu-item" data-action="reset">Reset Defaults</div>
  <div class="menu-item" data-action="about">About</div>
</div>

<div id="search-view" class="view-section">
  <div id="search-container">
    <input type="text" id="search-input" placeholder="Type name...">
  </div>
  <div id="search-results"></div>
</div>

<div id="player-view">
  <video id="video-player" controls playsinline></video>
</div>

<input type="file" id="file-upload" accept=".m3u,.txt">

<div id="custom-alert-overlay">
  <div class="alert-box">
    <div class="alert-header">About</div>
    <div class="alert-body" id="custom-alert-msg"></div>
    <div class="alert-footer">
      <center><button id="custom-alert-ok" class="alert-btn">OK</button></center>
    </div>
  </div>
</div>

<div id="soft-keys">
  <div class="key-col" id="lsk">
    <svg class="key-icon" viewBox="0 0 24 24"><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
  </div>
  <div class="key-col" id="csk">
    <svg class="key-icon" id="icon-center" viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>
  </div>
  <div class="key-col" id="rsk">
    <svg class="key-icon" viewBox="0 0 24 24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
  </div>
</div>

<script>
// --- CONFIGURATION ---
var DEFAULT_M3U = '#EXTM3U\n' +
'#EXTINF:-1 group-title="Bangla" tvg-logo="https://dl.dropbox.com/s/leielj83em5kg7h/somoy_news.png",Somoy TV\n' +
'https://owrcovcrpy.gpcdn.net/bpk-tv/1702/output/index.m3u8\n' +
'#EXTINF:-1 group-title="Bangla" tvg-logo="https://dl.dropbox.com/s/k7z1dsec1jfjbkn/jamuna_tv_bd.png",Jamuna TV\n' +
'https://owrcovcrpy.gpcdn.net/bpk-tv/1701/output/index.m3u8\n' +
'#EXTINF:-1 group-title="Sports" tvg-logo="https://upload.wikimedia.org/wikipedia/en/2/29/TSportsBD.png",T Sports\n' +
'http://103.60.204.26:3255/TSportsHD/tracks-v1a1/mono.m3u8\n' +
'#EXTINF:-1 group-title="Entertainment" tvg-logo="https://upload.wikimedia.org/wikipedia/en/thumb/8/8c/Sony_Entertainment_Television_logo.svg/1200px-Sony_Entertainment_Television_logo.svg.png",Sony TV\n' +
'http://103.60.204.26:3255/SonyEntertainmentTelevisionHD/tracks-v1a1/mono.m3u8';

var channels=[], filteredChannels=[], currentView='home', focusIndex=0;
var elHeader=document.getElementById('header');
var elHome=document.getElementById('home-view');
var elMenu=document.getElementById('menu-view');
var elSearch=document.getElementById('search-view');
var elPlayer=document.getElementById('player-view');
var elVideo=document.getElementById('video-player');
var elList=document.getElementById('channel-list');
var elSearchResults=document.getElementById('search-results');
var elSearchInput=document.getElementById('search-input');
var iconCenter=document.getElementById('icon-center');
var ICON_TICK='<path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>';
var ICON_PLAY='<path d="M8 5v14l11-7z"/>';
var ICON_PAUSE='<path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>';

// Custom alert
window.alert=function(message){
  var overlay=document.getElementById('custom-alert-overlay');
  var msgDiv=document.getElementById('custom-alert-msg');
  var btn=document.getElementById('custom-alert-ok');
  msgDiv.innerText=message;
  overlay.style.display='flex';
  btn.focus();
  btn.onclick=function(){ overlay.style.display='none'; if(currentView==='home'||currentView==='search') updateFocus(); else if(currentView==='menu'){ var items=elMenu.children; if(items[focusIndex]) items[focusIndex].classList.add('focused'); } };
};

// INIT
window.onload=function(){
  var savedData=localStorage.getItem('bd_iptv_playlist');
  if(!savedData){ localStorage.setItem('bd_iptv_playlist', DEFAULT_M3U); savedData=DEFAULT_M3U; }
  parseM3U(savedData);
  renderChannels(channels,elList);
  history.replaceState({view:'home'},"Home","");
  window.onpopstate=function(event){ if(event.state) switchView(event.state.view,false); else switchView('home',false); };
};

// Parse M3U
function parseM3U(data){ var lines=data.split('\n'); channels=[]; var item={}; for(var i=0;i<lines.length;i++){ var line=lines[i].trim(); if(line.indexOf('#EXTINF:')===0){ var logo=line.match(/tvg-logo="([^"]*)"/); item.logo=logo?logo[1]:''; var group=line.match(/group-title="([^"]*)"/); item.group=group?group[1]:'General'; var parts=line.split(','); item.name=parts[parts.length-1].trim(); } else if(line.length>0 && line.indexOf('#')!==0){ item.url=line; channels.push(item); item={}; } }}

// Render channels
function renderChannels(data,container){
  container.innerHTML='';
  if(data.length===0){ container.innerHTML='<div style="padding:20px;text-align:center;color:#777">No channels</div>'; return; }
  for(var i=0;i<data.length;i++){
    var div=document.createElement('div'); div.className='channel-item';
    div.innerHTML='<img src="'+(data[i].logo||'')+'" class="channel-logo" onerror="this.style.display=\'none\'"><div class="channel-info"><span class="channel-name">'+data[i].name+'</span><span class="group-title">'+data[i].group+'</span></div>';
    (function(idx){ div.onclick=function(){ focusIndex=idx; updateFocus(); playChannel(data[idx].url); }; })(i);
    container.appendChild(div);
  }
  updateFocus();
}

// Switch view
function switchView(viewName,pushHistory){
  elHome.classList.remove('active'); elMenu.classList.remove('active'); elSearch.classList.remove('active'); elPlayer.style.display='none';
  if(currentView==='player' && viewName!=='player'){ elVideo.pause(); elVideo.src=''; }
  currentView=viewName; focusIndex=0;
  if(viewName==='home'){ elHome.classList.add('active'); elHeader.innerText="IPTV"; iconCenter.innerHTML=ICON_TICK; updateFocus(); }
  else if(viewName==='menu'){ elMenu.classList.add('active'); elHeader.innerText="Menu"; iconCenter.innerHTML=ICON_TICK; updateFocus(); }
  else if(viewName==='search'){ elSearch.classList.add('active'); elHeader.innerText="Search"; iconCenter.innerHTML=ICON_TICK; elSearchInput.value=''; elSearchInput.focus(); elSearchResults.innerHTML=''; }
  else if(viewName==='player'){ elPlayer.style.display='block'; elHeader.innerText="Playing..."; iconCenter.innerHTML=ICON_PAUSE; }
  if(pushHistory) history.pushState({view:viewName},viewName,"#"+viewName);
}

// Update focus
function updateFocus(){ var items; if(currentView==='home') items=elList.children; else if(currentView==='menu') items=elMenu.children; else if(currentView==='search') items=elSearchResults.children; else return; for(var i=0;i<items.length;i++) items[i].classList.remove('focused'); if(items.length>0){ if(focusIndex>=items.length) focusIndex=items.length-1; if(focusIndex<0) focusIndex=0; items[focusIndex].classList.add('focused'); items[focusIndex].scrollIntoView({block:"center"}); }}

// Handle Enter
function handleEnter(){
  if(currentView==='home'){ if(channels[focusIndex]) playChannel(channels[focusIndex].url); }
  else if(currentView==='menu'){ var action=elMenu.children[focusIndex].getAttribute('data-action');
    if(action==='search') switchView('search',true);
    else if(action==='upload') document.getElementById('file-upload').click();
    else if(action==='reset'){ localStorage.setItem('bd_iptv_playlist', DEFAULT_M3U); alert("Defaults Restored!"); location.reload(); }
    else if(action==='about') alert("IPTV Pro v1.0\nFor CloudPhone");
  }
  else if(currentView==='search'){ if(document.activeElement===elSearchInput){ elSearchInput.blur(); focusIndex=0; updateFocus(); } else{ if(filteredChannels[focusIndex]) playChannel(filteredChannels[focusIndex].url); } }
  else if(currentView==='player'){ if(elVideo.paused){ elVideo.play(); iconCenter.innerHTML=ICON_PAUSE; } else { elVideo.pause(); iconCenter.innerHTML=ICON_PLAY; } }
}

// Play channel
function playChannel(url){ switchView('player',true); if(Hls.isSupported()){ var hls=new Hls(); hls.loadSource(url); hls.attachMedia(elVideo); hls.on(Hls.Events.MANIFEST_PARSED,function(){ elVideo.play(); }); } else if(elVideo.canPlayType('application/vnd.apple.mpegurl')){ elVideo.src=url; elVideo.play(); } else { alert("Unsupported format"); }}

// File Upload
document.getElementById('file-upload').addEventListener('change',function(e){
  var file=e.target.files[0]; if(!file) return;
  var reader=new FileReader();
  reader.onload=function(e){ localStorage.setItem('bd_iptv_playlist', e.target.result); parseM3U(e.target.result); renderChannels(channels,elList); alert("Playlist Loaded!"); history.back(); };
  reader.readAsText(file);
});

// Search input
elSearchInput.addEventListener('input',function(e){ var term=e.target.value.toLowerCase(); filteredChannels=channels.filter(function(ch){return ch.name.toLowerCase().includes(term);}); renderChannels(filteredChannels,elSearchResults); });

// Key navigation
document.addEventListener('keydown',function(e){
  var key=e.key;
  if(document.getElementById('custom-alert-overlay').style.display==='flex'){ e.preventDefault(); e.stopPropagation(); if(key==='Enter'||key==='SoftCenter'||key==='5') document.getElementById('custom-alert-ok').click(); return; }
  if(key==='ArrowDown'){ focusIndex++; updateFocus(); }
  else if(key==='ArrowUp'){ focusIndex--; updateFocus(); }
  else if(key==='Enter'||key==='SoftCenter'||key==='5'){ handleEnter(); }
  else if(key==='SoftLeft'||key==='F1'){ if(currentView==='home') switchView('menu',true); }
  else if(key==='SoftRight'||key==='F2'||key==='Backspace'){ history.back(); e.preventDefault(); }
});

// Softkeys
document.getElementById('lsk').onclick=function(){ if(currentView==='home') switchView('menu',true); };
document.getElementById('rsk').onclick=function(){ history.back(); };
document.getElementById('csk').onclick=handleEnter;
</script>
</body>
</html>
