<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="referrer" content="no-referrer">
    <title>NexGenBD - Stream App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://vjs.zencdn.net/7.20.3/video-js.css" rel="stylesheet" />
    <style>
        /* --- ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü --- */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { 
            background-color: #0b0c10; 
            color: #e2e8f0; 
            font-family: sans-serif; 
            overflow: hidden; /* ‡¶™‡ßÅ‡¶∞‡ßã ‡¶™‡ßá‡¶ú ‡¶≤‡¶ï */
            touch-action: pan-y; 
            margin: 0; padding: 0;
        }

        /* --- ‡¶Æ‡ßá‡¶á‡¶® ‡¶≤‡ßá‡¶Ü‡¶â‡¶ü --- */
        .app-layout { display: flex; flex-direction: column; height: 100vh; width: 100vw; overflow: hidden; }
        
        /* ‡¶™‡¶ø‡¶∏‡¶ø ‡¶≠‡¶ø‡¶â */
        @media (min-width: 1024px) {
            .app-layout { flex-direction: row; }
            .video-section { width: 70%; height: 100vh; background: #000; display: flex; align-items: center; justify-content: center; }
            .list-section { width: 30%; height: 100vh; background: #121318; border-left: 1px solid #2d303e; display: flex; flex-direction: column; }
            .video-wrapper { width: 100%; height: 100%; }
        }

        /* ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶≠‡¶ø‡¶â (‡¶´‡¶ø‡¶ï‡ßç‡¶∏‡¶°) */
        @media (max-width: 1023px) {
            .app-layout { display: block; position: relative; }
            .video-section { 
                position: fixed; top: 0; left: 0; width: 100%; z-index: 50; background: #000; 
            }
            .video-wrapper { padding-top: 56.25%; position: relative; } /* 16:9 Ratio */
            
            .list-section { 
                position: absolute; 
                top: 56.25vw; /* ‡¶™‡ßç‡¶≤‡ßá‡¶Ø‡¶º‡¶æ‡¶∞‡ßá‡¶∞ ‡¶®‡¶ø‡¶ö ‡¶•‡ßá‡¶ï‡ßá ‡¶∂‡ßÅ‡¶∞‡ßÅ */
                bottom: 0; 
                left: 0; 
                width: 100%; 
                background: #121318; 
                display: flex;
                flex-direction: column;
                overflow: hidden;
            }
        }

        #iptv-player { position: absolute; top: 0; left: 0; width: 100% !important; height: 100% !important; }

        /* --- ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨ ‡¶Æ‡ßá‡¶®‡ßÅ --- */
        .tabs-header {
            flex-shrink: 0;
            background: #1a1c24;
            border-bottom: 1px solid #2d303e;
            padding: 10px 0;
        }
        .tabs-container {
            display: flex;
            overflow-x: auto;
            padding: 0 12px;
            gap: 8px;
            scrollbar-width: none;
        }
        .tabs-container::-webkit-scrollbar { display: none; }
        
        .tab-btn {
            white-space: nowrap;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            color: #94a3b8;
            background: #252830;
            border: 1px solid #353842;
        }
        .active-tab { background: #3b82f6; color: white; border-color: #3b82f6; }

        /* --- ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶ó‡ßç‡¶∞‡¶ø‡¶° (Strict 3 Columns) --- */
        .grid-scroll-area {
            flex: 1;
            overflow-y: auto;
            padding: 12px;
            width: 100%;
        }
        .grid-container {
            display: grid;
            /* minmax(0, 1fr) ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá ‡¶Ø‡¶æ‡¶§‡ßá ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶®‡ßç‡¶ü ‡¶¨‡ßú ‡¶π‡¶≤‡ßá‡¶ì ‡¶ï‡¶≤‡¶æ‡¶Æ ‡¶¨‡ßú ‡¶®‡¶æ ‡¶π‡ßü */
            grid-template-columns: repeat(3, minmax(0, 1fr)); 
            gap: 10px;
            width: 100%;
        }
        /* ‡¶™‡¶ø‡¶∏‡¶ø‡¶§‡ßá ‡ß™ ‡¶ï‡¶≤‡¶æ‡¶Æ */
        @media (min-width: 1200px) { .grid-container { grid-template-columns: repeat(4, minmax(0, 1fr)); } }

        /* --- ‡¶ï‡¶æ‡¶∞‡ßç‡¶° ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶® (‡¶´‡¶ø‡¶ï‡ßç‡¶∏‡¶° ‡¶∏‡¶æ‡¶á‡¶ú) --- */
        .channel-card {
            background: #1e2029;
            border-radius: 10px;
            padding: 8px 4px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 1px solid #2d303e;
            position: relative;
            /* ‡¶π‡¶æ‡¶á‡¶ü ‡¶´‡¶ø‡¶ï‡ßç‡¶∏ ‡¶ï‡¶∞‡ßá ‡¶¶‡ßá‡¶ì‡ßü‡¶æ ‡¶π‡¶≤‡ßã ‡¶Ø‡¶æ‡¶§‡ßá ‡¶¨‡ßú ‡¶≤‡ßã‡¶ó‡ßã ‡¶ï‡¶æ‡¶∞‡ßç‡¶°‡¶ï‡ßá ‡¶¨‡ßú ‡¶®‡¶æ ‡¶ï‡¶∞‡ßá */
            height: 100px; 
            width: 100%;
            overflow: hidden;
        }
        .channel-card:active { background: #2a2c33; transform: scale(0.98); }
        .selected-card { border: 2px solid #3b82f6 !important; background: #1e2538; }

        /* --- ‡¶≤‡ßã‡¶ó‡ßã ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶® (‡¶≤‡¶ï‡¶° ‡¶∏‡¶æ‡¶á‡¶ú) --- */
        .logo-wrapper {
            width: 40px; /* ‡¶´‡¶ø‡¶ï‡ßç‡¶∏‡¶° ‡¶â‡¶á‡¶• */
            height: 40px; /* ‡¶´‡¶ø‡¶ï‡ßç‡¶∏‡¶° ‡¶π‡¶æ‡¶á‡¶ü */
            background: #ffffff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 8px;
            padding: 4px;
            overflow: hidden; /* ‡¶õ‡¶¨‡¶ø ‡¶¨‡ßú ‡¶π‡¶≤‡ßá ‡¶ï‡ßá‡¶ü‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá */
            flex-shrink: 0; /* ‡¶ö‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶ü‡¶æ ‡¶π‡¶¨‡ßá ‡¶®‡¶æ */
        }
        .logo-wrapper img {
            width: 100%;
            height: 100%;
            object-fit: contain; /* ‡¶∞‡ßá‡¶∂‡¶ø‡¶ì ‡¶†‡¶ø‡¶ï ‡¶∞‡ßá‡¶ñ‡ßá ‡¶´‡¶ø‡¶ü ‡¶π‡¶¨‡ßá */
        }

        .ch-name { 
            font-size: 11px; 
            font-weight: 700; 
            color: #e2e8f0; 
            text-align: center; 
            line-height: 1.2;
            width: 100%;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis; /* ‡¶®‡¶æ‡¶Æ ‡¶¨‡ßú ‡¶π‡¶≤‡ßá ... ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá */
        }

        /* ‡¶á‡¶®‡¶´‡ßã ‡¶¨‡¶æ‡¶∞ */
        .info-bar { 
            padding: 8px 12px; 
            background: #121318; 
            border-bottom: 1px solid #2d303e;
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            flex-shrink: 0;
        }
        .srv-btn { font-size: 9px; padding: 3px 8px; background: #334155; color: white; border-radius: 4px; font-weight: bold; margin-left: 4px; }
        .srv-active { background: #ef4444; }

        /* ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö ‡¶¨‡¶ï‡ßç‡¶∏ */
        .search-box { padding: 8px 12px; background: #121318; flex-shrink: 0; }
        .search-input { width: 100%; background: #1a1c24; border: 1px solid #2d303e; border-radius: 8px; padding: 8px; color: white; font-size: 13px; outline: none; }
    </style>
</head>
<body>

    <div class="app-layout">
        <div class="video-section">
            <div class="video-wrapper">
                <video id="iptv-player" class="video-js vjs-big-play-centered vjs-theme-city" controls preload="auto"></video>
            </div>
        </div>

        <div class="list-section">
            <div class="info-bar">
                <span class="text-xs font-bold text-white truncate max-w-[60%]" id="playing-title">Select Channel</span>
                <div id="server-options" class="flex"></div>
            </div>

            <div class="tabs-header">
                <div class="tabs-container">
                    <button class="tab-btn active-tab" onclick="filterData('all')">üî• VIP</button>
                    <button class="tab-btn" onclick="filterData('sports')">Sports</button>
                    <button class="tab-btn" onclick="filterData('news')">News</button>
                    <button class="tab-btn" onclick="filterData('indian')">Indian</button>
                    <button class="tab-btn" onclick="filterData('kids')">Kids</button>
                </div>
            </div>

            <div class="search-box">
                <input type="text" id="search" placeholder="Search..." class="search-input">
            </div>

            <div class="grid-scroll-area">
                <div class="grid-container" id="channel-grid">
                    <div class="text-slate-500 text-xs col-span-3 text-center mt-10">Loading...</div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://vjs.zencdn.net/7.20.3/video.min.js"></script>
    <script>
        const player = videojs('iptv-player', { fluid: false, liveui: true });
        let allData = {};
        
        // ‡¶Ü‡¶Æ‡¶ø ‡¶∏‡¶¨ ‡¶≤‡ßã‡¶ó‡ßã ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶™ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶¶‡¶ø‡ßü‡ßá‡¶õ‡¶ø ‡¶Ø‡¶æ‡¶§‡ßá ‡¶™‡ßç‡¶≤‡ßá‡¶≤‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶∞ ‡¶≤‡ßã‡¶ó‡ßã‡¶á ‡¶≤‡ßã‡¶° ‡¶π‡ßü ‡¶è‡¶¨‡¶Ç CSS ‡¶∏‡ßá‡¶ü‡¶æ‡¶ï‡ßá ‡¶∏‡¶æ‡¶á‡¶ú ‡¶ï‡¶∞‡ßá ‡¶®‡ßá‡ßü
        // ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶ú‡¶∞‡ßÅ‡¶∞‡¶ø ‡¶≤‡ßã‡¶ó‡ßã ‡¶∞‡¶æ‡¶ñ‡¶æ ‡¶π‡¶≤‡ßã
        const logoMap = {
            "GTV": "https://upload.wikimedia.org/wikipedia/en/2/20/GTVBangladeshLogo.png"
        };

        const nameCorrection = {
            "jumuna": "JAMUNA TV", "jamuna": "JAMUNA TV",
            "somoy": "SOMOY TV", "somoy tv": "SOMOY TV",
            "t sports": "T SPORTS", "tsports": "T SPORTS",
            "g tv": "GTV", "gazi tv": "GTV",
            "channel 24": "CHANNEL 24", "atn news": "ATN NEWS",
            "star jalsha": "STAR JALSHA", "zee bangla": "ZEE BANGLA"
        };

        const vipList = ["T SPORTS", "GTV", "JAMUNA TV", "SOMOY TV", "EKATTOR TV", "INDEPENDENT TV", "CHANNEL 24", "STAR JALSHA"];

        async function init() {
            try {
                const res = await fetch('fetch_m3u.php');
                const text = await res.text();
                parseM3U(text);
            } catch (err) { console.error(err); }
        }

        function cleanName(name) {
            let n = name.toLowerCase().replace(/([\u2700-\u27BF]|[\uE000-\uF8FF]|\uD83C[\uDC00-\uDFFF]|\uD83D[\uDC00-\uDFFF]|[\u2011-\u26FF])/g, '')
                        .replace(/hd|sd|live|tv|bd|\[.*?\]|\(.*?\)|-|\|/gi, '').trim();
            for (let key in nameCorrection) if (n.includes(key)) return nameCorrection[key];
            return n.toUpperCase();
        }

        function parseM3U(data) {
            const lines = data.split('\n');
            allData = {};

            for (let i = 0; i < lines.length; i++) {
                if (lines[i].startsWith('#EXTINF')) {
                    const info = lines[i];
                    const url = lines[i + 1]?.trim();
                    if (!url || !url.startsWith('http')) continue;

                    let rawName = info.split(',')[1]?.trim() || "Unknown";
                    let finalName = cleanName(rawName);
                    if (finalName.length < 2) continue;

                    // ‡¶≤‡ßã‡¶ó‡ßã ‡¶π‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶°‡¶≤‡¶ø‡¶Ç
                    let logoMatch = info.match(/tvg-logo="([^"]+)"/);
                    let playlistLogo = logoMatch ? logoMatch[1] : '';
                    let mapLogo = logoMap[finalName];
                    let finalLogo = mapLogo ? mapLogo : playlistLogo;
                    if(!finalLogo) finalLogo = `https://via.placeholder.com/50?text=${finalName[0]}`;

                    if (!allData[finalName]) {
                        allData[finalName] = { name: finalName, logo: finalLogo, urls: [] };
                    }
                    if(!allData[finalName].urls.includes(url)) allData[finalName].urls.push(url);
                }
            }
            filterData('all');
        }

        function getPriority(name) {
            for (let i = 0; i < vipList.length; i++) {
                if (name.includes(vipList[i])) return i;
            }
            return 999;
        }

        window.filterData = (cat) => {
            document.querySelectorAll('.tab-btn').forEach(btn => {
                if(btn.innerText.toLowerCase().includes(cat === 'all' ? 'vip' : cat)) btn.classList.add('active-tab');
                else btn.classList.remove('active-tab');
            });

            const container = document.getElementById('channel-grid');
            container.innerHTML = '';
            
            let channels = Object.values(allData);

            if (cat === 'sports') channels = channels.filter(c => c.name.match(/SPORTS|CRICKET|FOOTBALL|GTV|BPL/));
            else if (cat === 'news') channels = channels.filter(c => c.name.match(/NEWS|SOMOY|JAMUNA|EKATTOR|24|INDEPENDENT|BTV/));
            else if (cat === 'indian') channels = channels.filter(c => c.name.match(/JALSHA|ZEE|COLORS|SONY|STAR/));
            else if (cat === 'kids') channels = channels.filter(c => c.name.match(/CARTOON|NICK|DISNEY|KIDS/));

            channels.sort((a, b) => {
                let pA = getPriority(a.name);
                let pB = getPriority(b.name);
                if (pA !== pB) return pA - pB;
                return a.name.localeCompare(b.name);
            });

            channels.forEach(ch => {
                const div = document.createElement('div');
                div.className = 'channel-card';
                div.innerHTML = `
                    <div class="logo-wrapper">
                        <img src="${ch.logo}" onerror="this.src='https://via.placeholder.com/50?text=${ch.name[0]}'">
                    </div>
                    <div class="ch-name">${ch.name}</div>
                `;
                div.onclick = () => playChannel(ch, div);
                container.appendChild(div);
            });
        }

        function playChannel(ch, el) {
            document.getElementById('playing-title').innerText = ch.name;
            const sDiv = document.getElementById('server-options');
            sDiv.innerHTML = '';
            
            player.pause();
            player.src({ type: 'application/x-mpegURL', src: ch.urls[0] });
            player.ready(() => { player.play().catch(e => console.log(e)); });

            ch.urls.forEach((url, i) => {
                let btn = document.createElement('button');
                btn.className = 'srv-btn ml-1';
                btn.innerText = `S${i+1}`;
                btn.onclick = () => {
                    player.src({ type: 'application/x-mpegURL', src: url });
                    player.play();
                    document.querySelectorAll('.srv-btn').forEach(b => b.classList.remove('srv-active'));
                    btn.classList.add('srv-active');
                };
                sDiv.appendChild(btn);
                if(i===0) btn.classList.add('srv-active');
            });

            document.querySelectorAll('.channel-card').forEach(c => c.classList.remove('selected-card'));
            el.classList.add('selected-card');
        }

        document.getElementById('search').oninput = (e) => {
            let val = e.target.value.toUpperCase();
            document.querySelectorAll('.channel-card').forEach(card => {
                card.style.display = card.innerText.toUpperCase().includes(val) ? 'flex' : 'none';
            });
        };

        init();
    </script>
</body>
</html>
